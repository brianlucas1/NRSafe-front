<p-confirmDialog></p-confirmDialog>

<div class="card w-full" *ngIf="planos">
  <div class="card-header">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
      <div>
        <h2>Planos disponiveis</h2>
        <p class="text-sm opacity-70">Escolha o ciclo e a quantidade de usuarios</p>
      </div>
      <div class="flex items-center gap-2 rounded-full bg-gray-100 p-1">
        <button
          type="button"
          class="px-4 py-2 rounded-full text-sm font-medium transition"
          [ngClass]="cicloSelecionado() === 'MENSAL' ? 'bg-white text-gray-900 shadow' : 'text-gray-600'"
          (click)="selecionarCiclo('MENSAL')"
        >
          Mensal
        </button>
        <button
          type="button"
          class="px-4 py-2 rounded-full text-sm font-medium transition"
          [ngClass]="cicloSelecionado() === 'ANUAL' ? 'bg-white text-gray-900 shadow' : 'text-gray-600'"
          (click)="selecionarCiclo('ANUAL')"
        >
          Anual
        </button>
      </div>
    </div>
    <div class="mt-2 text-xs opacity-70">
      No anual, voce paga 11 meses e ganha 1 mes de desconto.
    </div>
  </div>
  <div class="card-body">
    <p-carousel
      [value]="planos()"
      [numVisible]="3"
      [numScroll]="1"
      [circular]="false"
      [showIndicators]="true"
      [autoplayInterval]="0"
      [responsiveOptions]="carouselResponsiveOptions"
      styleClass="w-full"
    >
      <ng-template pTemplate="item" let-p>
        <p-card class="h-full shadow-sm rounded-2xl border border-gray-100" [ngClass]="{ 'ring-2 ring-green-500 bg-green-50': isPlanoAtual(p) }">
          <ng-template pTemplate="header">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-lg font-semibold">{{ p.nomePlano }}</div>
                <div class="text-xs opacity-70">{{ p.descPlano }}</div>
              </div>
              <div class="flex flex-col items-end gap-1">
                <p-tag *ngIf="isPlanoAtual(p)" severity="success" value="Plano atual"></p-tag>
                <p-tag *ngIf="cicloSelecionado() === 'ANUAL'" severity="info" value="1 mes de desconto"></p-tag>
              </div>
            </div>
          </ng-template>

          <div class="mt-3 flex flex-col gap-4">
            <div class="rounded-xl bg-gray-50 p-4 flex items-center justify-between gap-4">
              <div>
                <div class="text-3xl font-bold">
                  {{ getPrecoExibido(p) | currency:'BRL':'symbol':'1.2-2' }}
                </div>
                <div class="text-xs opacity-70">
                  / {{ cicloSelecionado() === 'MENSAL' ? 'mes' : 'ano' }}
                </div>
                <div *ngIf="cicloSelecionado() === 'ANUAL'" class="text-xs text-green-600 mt-1">
                  equivalente a {{ p.precoMensal | currency:'BRL':'symbol':'1.2-2' }} / mes
                </div>
              </div>
              <div class="text-right">
                <div class="text-xs uppercase tracking-wide opacity-70">Usuarios</div>
                <div class="text-2xl font-semibold">{{ getLimiteUsuarios(p) }}</div>
              </div>
            </div>

            <div>
              <div class="text-xs uppercase tracking-wide opacity-70 mb-2">Recursos</div>
              <ul class="space-y-1">
                <li *ngFor="let r of recursosSecundarios(p); trackBy: trackByRecursoId" class="flex items-center gap-2">
                  <i class="pi pi-check text-sm"></i>
                  <span class="text-sm">{{ r.chave }}: <b>{{ r.valor }}</b></span>
                </li>
              </ul>
            </div>
          </div>

          <ng-template pTemplate="footer">
            <div class="flex items-center justify-between">
              <div *ngIf="isPlanoAtual(p)" class="text-xs opacity-70">Plano atual selecionado</div>
              <p-button
                *ngIf="!isPlanoAtual(p)"
                label="Selecionar"
                (onClick)="confirmarTrocaPlano(p)"
                [styleClass]="
                  (tipoDeMovimento(p) === 'upgrade'
                    ? 'p-button-success'
                    : (tipoDeMovimento(p) === 'downgrade'
                        ? 'p-button-warning'
                        : 'p-button-secondary'))
                "
              ></p-button>
            </div>
          </ng-template>
        </p-card>
      </ng-template>
    </p-carousel>
  </div>
</div>
